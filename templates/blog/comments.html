{% load static %}
{% load django_bootstrap5 %}

<div class="comment-section">
    <h3 class="comment-counter">{{ comments.count }} COMMENT{{ comments|pluralize }}</h3>

    <!--=======  comment container  =======-->

    <div class="comment-container mb-40">
        <!--=======  single comment  =======-->
        {% for comment in comments %}
        <blockquote class="blockquote">
            <p class="mb-0"><small>{{ comment.content }}</small></p>
            <footer class="blockquote-footer"><small>by <cite title="Source Title">{{ comment.user.first_name|capfirst }} {{ comment.user.last_name|capfirst }}| {{ comment.timestamp|timesince }} ago </cite></small>
              <button type="button" name="button" class="reply-btn btn btn-theme">Reply</button>
            </footer>
              <div class="container mt-2">
                  {% for reply in comment.replies.all %}
                    <blockquote class="blockquote">
                      <p class="mb-0"><small>{{ reply.content }}</small></p>
                      <footer class="blockquote-footer"><small>by <cite title="Source Title">{{ reply.user|capfirst }}| {{ reply.timestamp|timesince }} ago </cite></small>
                    </footer>
                    </blockquote>
                  {% endfor %}
              </div>
        </blockquote>


        <div class="replied-comments container mt-2" style="display:none;">

            <div class="comment-form">
              <form method="post" class="reply-form" action=".">
                {% csrf_token %}
                <input type="hidden" name="comment_id" value="{{ comment.id }}">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="form-group">
                        {% bootstrap_field comment_form.content %}
                    </div>
                </div>

                {% if request.user.is_authenticated %}
                <div class="form-group col-md-12">
                  <button type="submit" class="post-comment-btn" name="submit">Reply Comment</button>
                </div>
                {% else %}
                <div class="form-group col-md-12">
                  <button type="submit" class="post-comment-btn" name="submit" disabled>Reply Comment</button>
                </div>
                {% endif %}
              </form>
            </div>
          </div>
        {% endfor %}

        <!--=======  End of single comment  =======-->
    </div>

    <!--=======  End of comment container  =======-->

    <!--=======  comment form container  =======-->

    <div class="comment-form-container">
        <h3 class="comment-form-title">LEAVE A COMMENT</h3>
        <!--=======  comment form  =======-->

        <div class="comment-form">

             <form action="." class="comment-form" method="POST">
                {% csrf_token %}
                  <div class="row">
                    <div class="form-group col-md-12">
                      {% bootstrap_field comment_form.content %}
                    </div>
                    {% if request.user.is_authenticated %}
                    <div class="form-group col-md-12">
                      <button type="submit" class="post-comment-btn" name="submit">Submit Comment</button>
                    </div>
                    {% else %}
                    <div class="form-group col-md-12">
                      <button type="submit" class="post-comment-btn" name="submit" disabled>Submit Comment</button>
                    </div>
                    {% endif %}
                  </div>
              </form>
        </div>

        <!--=======  End of comment form  =======-->
    </div>

    <!--=======  End of comment form container  =======-->

</div>


