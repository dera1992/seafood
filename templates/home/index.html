{% extends "base.html" %}
{% load static %}
{% load django_bootstrap5 %}
{% load i18n %}
{% load thumbnail %}
{% load humanize %}
{% load hitcount_tags %}

{% block title %}{% endblock %}

{% block extra_head %}
    <style>
        .nearby-shop-section {
            position: relative;
            padding: 48px 40px;
            border-radius: 28px;
            background: linear-gradient(135deg, rgba(20, 115, 78, 0.08), rgba(255, 255, 255, 0.92));
            box-shadow: 0 20px 40px rgba(12, 74, 45, 0.12);
            overflow: hidden;
        }

        .nearby-shop-section::before,
        .nearby-shop-section::after {
            content: "";
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            filter: blur(0);
            opacity: 0.4;
            z-index: 0;
        }

        .nearby-shop-section::before {
            top: -80px;
            right: -40px;
            background: radial-gradient(circle, rgba(30, 181, 121, 0.35), transparent 70%);
        }

        .nearby-shop-section::after {
            bottom: -110px;
            left: -60px;
            background: radial-gradient(circle, rgba(255, 193, 7, 0.35), transparent 70%);
        }

        .nearby-shop-section .section-title,
        .nearby-shop-section .row,
        .nearby-shop-section .mt-3,
        .nearby-shop-section .mt-4 {
            position: relative;
            z-index: 1;
        }

        .nearby-shop-section .section-pill {
            background: rgba(20, 115, 78, 0.12);
            color: #145b3b;
        }

        .nearby-shop-section .form-select {
            border-radius: 16px;
            border: 1px solid rgba(20, 115, 78, 0.2);
            padding: 12px 16px;
            box-shadow: 0 10px 24px rgba(20, 115, 78, 0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .nearby-shop-section .form-select:focus {
            transform: translateY(-2px);
            box-shadow: 0 16px 32px rgba(20, 115, 78, 0.18);
        }

        .nearby-shop-section .nearby-action {
            border-radius: 16px;
            padding: 12px 28px;
            border: none;
            background: linear-gradient(135deg, #1bbf7a, #0f6b45);
            color: #fff;
            box-shadow: 0 16px 30px rgba(20, 115, 78, 0.25);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .nearby-shop-section .nearby-action::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -60%;
            width: 180%;
            height: 180%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.35), transparent 60%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .nearby-shop-section .nearby-action:hover,
        .nearby-shop-section .nearby-action:focus {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(20, 115, 78, 0.35);
            color: #fff;
        }

        .nearby-shop-section .nearby-action:hover::after,
        .nearby-shop-section .nearby-action:focus::after {
            opacity: 1;
        }

        #nearby-status {
            padding: 10px 16px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(20, 115, 78, 0.12);
            color: #1a4d37;
            box-shadow: 0 12px 20px rgba(20, 115, 78, 0.08);
        }

        #nearby-results .card,
        #nearby-results .nearby-shop-card,
        #nearby-results .nearby-result-card {
            border-radius: 20px;
            border: 1px solid rgba(20, 115, 78, 0.15);
            box-shadow: 0 16px 32px rgba(12, 74, 45, 0.12);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        #nearby-results .card:hover,
        #nearby-results .nearby-shop-card:hover,
        #nearby-results .nearby-result-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 22px 38px rgba(12, 74, 45, 0.18);
        }
    </style>
{% endblock %}

{% block content %}
    <div class="modern-home">
    <div class="hero-slider-with-category-container mt-35 mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-md-12">
					<!--=======  slider container  =======-->

					<div class="slider-container">
                        <!--=======  Slider area  =======-->

                        <div class="hero-slider-two">

                            <!--=======  Hero slider item  =======-->

                            <div class="hero-slider-item slider-bg-4 modern-hero">
                                <div class="slider-content modern-hero__content">
                                    <div class="hero-badges">
                                        <span class="hero-badge">Cut food waste</span>
                                        <span class="hero-badge">Local shops</span>
                                        <span class="hero-badge">Fresh deals</span>
                                    </div>
                                    <h1>Save more on<span> fresh food</span></h1>
                                    <h1 class="change-text">Shop near-expiry<span> deals</span></h1>

                                    <p class="hero-subtitle">Discover trusted neighborhood shops, buy surplus items, and keep good food out of the bin.</p>

                                    <div class="hero-highlights">
                                        <span><img src="{% static 'assets/images/icon-slider.png' %}" alt=""> Save up to 10%</span>
                                        <span><img src="{% static 'assets/images/icon-slider.png' %}" alt=""> Pick up fast</span>
                                        <span><img src="{% static 'assets/images/icon-slider.png' %}" alt=""> Verified sellers</span>
                                    </div>

                                    <div class="hero-actions">
                                        <a href="{% url 'home:ads_list' %}" class="slider-two-btn">Start buying</a>
                                        <a href="{% url 'product_search:product_filter' %}" class="slider-two-btn hero-secondary">Browse offers</a>
                                    </div>

                                    <div class="hero-stat-grid">
                                        <div class="hero-stat">
                                            <h3>1.2k+</h3>
                                            <p>Weekly deals rescued</p>
                                        </div>
                                        <div class="hero-stat">
                                            <h3>42m</h3>
                                            <p>Avg pickup time</p>
                                        </div>
                                        <div class="hero-stat">
                                            <h3>4.9★</h3>
                                            <p>Shopper rating</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="hero-orbit" aria-hidden="true">
                                    <span class="hero-orbit__dot"></span>
                                    <span class="hero-orbit__ring"></span>
                                </div>
                            </div>

                            <!--=======  End of Hero slider item  =======-->

                        </div>

                        <!--=======  End of Slider area  =======-->
					</div>

					<!--=======  End of slider container  =======-->
				</div>
			</div>
		</div>
	</div>

    <section class="modern-feature-section mb-35 nearby-shop-section">
        <div class="container">
            <div class="section-title modern-section-title">
                <h2 class="section-heading">Shop near you</h2>
                <p class="section-subtitle">Share your location to see nearby shops within minutes.</p>
            </div>
            <div class="nearby-controls">
                <button class="slider-two-btn hero-secondary nearby-action nearby-pill" id="find-shops-btn" type="button">
                    <span class="icon_pin_alt" aria-hidden="true"></span>
                    Use my location
                </button>
                <div class="nearby-pill nearby-radius">
                    <span class="icon_pin_alt" aria-hidden="true"></span>
                    <select id="nearby-radius" class="form-select nearby-select" aria-label="Search radius">
                        <option value="2">2 km</option>
                        <option value="5" selected>5 km</option>
                        <option value="10">10 km</option>
                        <option value="20">20 km</option>
                    </select>
                </div>
            </div>
            <div class="mt-3" id="nearby-status" role="status" aria-live="polite"></div>
            <div class="row mt-4" id="nearby-results"></div>
            <div class="mt-4">
                <a class="btn btn-outline-success nearby-browse-btn" href="{% url 'home:shop_list' %}">Browse all shops</a>
            </div>
        </div>
    </section>

    <section class="category-pill-section">
        <div class="container">
            <div class="section-title modern-section-title">
                <span class="section-pill">Shop by category</span>
                <p class="section-subtitle">Curated aisles to find the freshest near-you offers.</p>
            </div>
            <div class="category-pill-list">
                <a href="{% url 'product_search:product_filter' %}?category=Vegetables">Vegetables</a>
                <a href="{% url 'product_search:product_filter' %}?category=Fruits">Fruits</a>
                <a href="{% url 'product_search:product_filter' %}?category=Grains">Grains</a>
                <a href="{% url 'product_search:product_filter' %}?category=Seafood">Seafood</a>
                <a href="{% url 'product_search:product_filter' %}?category=Spices">Spices</a>
                <a href="{% url 'product_search:product_filter' %}?category=Meats">Meats</a>
                <a href="{% url 'product_search:product_filter' %}?category=Oil">Cooking Oil</a>
                <a href="{% url 'product_search:product_filter' %}?category=Honey">Honey</a>
                <a href="{% url 'product_search:product_filter' %}?category=Eggs">Eggs</a>
                <a href="{% url 'product_search:product_filter' %}?category=Others">Others</a>
            </div>
        </div>
    </section>

    <section class="modern-feature-section mb-35">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-6 mb-20">
                    <div class="modern-feature-card">
                        <div class="feature-icon"><span class="icon_cart_alt"></span></div>
                        <h4>Shop surplus, save money</h4>
                        <p>Find quality items at reduced prices as they get closer to expiry.</p>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-20">
                    <div class="modern-feature-card">
                        <div class="feature-icon"><span class="icon_pin_alt"></span></div>
                        <h4>Buy from nearby stores</h4>
                        <p>Support small shops and get deliveries or pickups faster.</p>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-20">
                    <div class="modern-feature-card">
                        <div class="feature-icon"><span class="icon_like_alt"></span></div>
                        <h4>Help reduce waste</h4>
                        <p>Every purchase prevents good food from being thrown away.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="slider multisale-slider mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multisale  slider section title  =======-->

					<div class="section-title modern-section-title">
						<span class="section-pill">Deal of the day</span>
                        <span class="pulse-dot" aria-hidden="true"></span>
                        <p class="section-subtitle">Limited picks updated every morning for maximum savings.</p>
					</div>

					<!--=======  End of multisale slider section title  =======-->
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multi sale slider wrapper  =======-->

					<div class="multisale-slider-wrapper">
						<!--=======  single multisale slider product  =======-->
                        {% for latest in latests %}
						<div class="gf-product multisale-slider-product">
							<div class="image">
								<a href="{{ latest.get_absolute_url }}">
									<span class="{{ latest.get_label_display }}">{{ latest.get_status_display }}</span>
                                    {% if latest.delivery %}
                                        <span class="days">Del:{{ latest.delivery }}</span>
                                    {% endif %}
                                    {% for images in latest.get_second_image %}
                                        {% thumbnail images.product_image "260x194" crop="10px 10px"  as im %}
                                                <img  style="margin:{{ im|margin:"260x194" }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}" class="img-fluid "  />
                                        {% endthumbnail %}
                                    {% endfor %}
								</a>
								<div class="product-hover-icons" id = "part{{ latest.id }}">
                                    {% if request.user.is_authenticated %}
                                        {% if request.user in latest.favourite.all %}
                                            {% csrf_token %}
                                            <a href="#" id = "cart" data-id="{{ latest.id }}"  data-tooltip="Add to cart"> <span class="icon_cart_alt"></span></a>
                                            <a href="#" id = "wishlist" data-id="{{ latest.id }}"  data-tooltip="Add to wishlist"> <span class="icon_heart"></span> </a>

                                        {% else %}
                                            <a href="#" id = "cart" data-id="{{ latest.id }}"  data-tooltip="Add to cart"> <span class="icon_cart_alt"></span></a>
                                            <a href="#" id = "wishlist" data-id="{{ latest.id }}"  data-tooltip="Add to wishlist"> <span class="icon_heart_alt"></span> </a>
                                        {% endif %}
                                    {% else %}
                                        <a href="{{ ad.get_add_to_cart_url }}"  data-tooltip="Add to cart"> <span class="icon_cart_alt"></span></a>
                                        <a href="{% url 'home:favourite_ad' id=latest.id %}" data-tooltip="Add to wishlist"> <span class="icon_heart_alt"></span> </a>
                                    {% endif %}

								</div>
							</div>
							<div class="product-content">
								<div class="product-categories">
									<a>{{ latest.category}}</a>
								</div>
								<h3 class="product-title"><a href="{{ latest.get_absolute_url }}">{{ latest.title }}</a></h3>
                                {% if latest.expires_on %}
                                    <div class="product-expiry">
                                        {% if latest.is_expired %}
                                            <span class="expiry-badge expired">Expired</span>
                                        {% elif latest.is_expiring_soon %}
                                            <span class="expiry-badge expiring">Expires in {{ latest.days_to_expire }} days</span>
                                        {% else %}
                                            <span class="expiry-badge fresh">Good for {{ latest.days_to_expire }} days</span>
                                        {% endif %}
                                    </div>
                                {% endif %}
								<div class="price-box">
                                     {% if latest.discount_price %}
                                      <span class="discounted-price">£{{ latest.discount_price|intcomma}}</span>
                                      <span class="main-price">£{{ latest.price|intcomma}}</span>
                                     {% else %}
                                      <span class="discounted-price">£{{ latest.price|intcomma}}</span>
                                    {% endif %}
								</div>
							</div>

						</div>
                        {% endfor %}
					</div>

					<!--=======  End of multi sale slider wrapper  =======-->
				</div>
			</div>
		</div>
	</div>

	<div class="featured-product-image-gallery mb-80 pt-120 section-bg modern-promo-strip">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  gallery product container  =======-->
					<div class="gallery-product-container">
						<div class="row no-gutters">
						</div>
					</div>

					<!--=======  End of gallery product container  =======-->

				</div>
			</div>
		</div>
	</div>

    <div class="slider multisale-slider mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="section-title modern-section-title">
						<span class="section-pill">Recommended for you</span>
                        {% if recommended_location.city or recommended_location.state %}
                            <p class="section-subtitle">
                                Based on your location:
                                {% if recommended_location.city %}{{ recommended_location.city }}{% endif %}
                                {% if recommended_location.state %}{% if recommended_location.city %}, {% endif %}{{ recommended_location.state }}{% endif %}
                            </p>
                        {% endif %}
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<div class="multisale-slider-wrapper">
                        {% for ad in recommended_products %}
						<div class="gf-product multisale-slider-product">
							<div class="image">
								<a href="{{ ad.get_absolute_url }}">
									<span class="{{ ad.get_label_display }}">{{ ad.get_status_display }}</span>
                                    {% if ad.delivery %}
                                        <span class="days">Del:{{ ad.delivery }}</span>
                                    {% endif %}
                                    {% for images in ad.get_second_image %}
                                        {% thumbnail images.product_image "260x194" crop="10px 10px"  as im %}
                                                <img  style="margin:{{ im|margin:"260x194" }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}" class="img-fluid "  />
                                        {% endthumbnail %}
                                    {% endfor %}
								</a>
								<div class="product-hover-icons" id = "part{{ ad.id }}">
									{% include 'home/special_section.html' %}
								</div>
							</div>
							<div class="product-content">
								<div class="product-categories">
									<a>{{ ad.category}}</a>
								</div>
								<h3 class="product-title"><a href="{{ ad.get_absolute_url }}">{{ ad.title }}</a></h3>
								<div class="price-box">
                                    {% if ad.discount_price %}
                                      <span class="discounted-price">£{{ ad.discount_price|intcomma}}</span>
                                      <span class="main-price">£{{ ad.discount_price|intcomma}}</span>
                                     {% else %}
                                      <span class="discounted-price">£{{ ad.price|intcomma}}</span>
                                    {% endif %}
								</div>
							</div>

						</div>
                        {% empty %}
                            <div class="container-fluid">
                                <h3 style="text-align:center;">No recommendations yet.</h3>
                            </div>
                        {% endfor %}
					</div>
				</div>
			</div>
		</div>
	</div>

    <div class="slider multisale-slider mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multisale  slider section title  =======-->

					<div class="section-title modern-section-title">
						<span class="section-pill">Tubers, Meats, Cooking Oils and Others</span>
					</div>

					<!--=======  End of multisale slider section title  =======-->
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multi sale slider wrapper  =======-->

					<div class="multisale-slider-wrapper">
						<!--=======  single multisale slider product  =======-->
                        {% for ad in ads %}
						<div class="gf-product multisale-slider-product">
							<div class="image">
								<a href="{{ ad.get_absolute_url }}">
									<span class="{{ ad.get_label_display }}">{{ ad.get_status_display }}</span>
                                    {% if ad.delivery %}
                                        <span class="days">Del:{{ ad.delivery }}</span>
                                    {% endif %}
                                    {% for images in ad.get_second_image %}
                                        {% thumbnail images.product_image "260x194" crop="10px 10px"  as im %}
                                                <img  style="margin:{{ im|margin:"260x194" }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}" class="img-fluid "  />
                                        {% endthumbnail %}
                                    {% endfor %}
								</a>
								<div class="product-hover-icons" id = "part{{ ad.id }}">
									{% include 'home/special_section.html' %}
								</div>
							</div>
							<div class="product-content">
								<div class="product-categories">
									<a>{{ ad.category}}</a>
								</div>
								<h3 class="product-title"><a href="{{ ad.get_absolute_url }}">{{ ad.title }}</a></h3>
                                {% if ad.expires_on %}
                                    <div class="product-expiry">
                                        {% if ad.is_expired %}
                                            <span class="expiry-badge expired">Expired</span>
                                        {% elif ad.is_expiring_soon %}
                                            <span class="expiry-badge expiring">Expires in {{ ad.days_to_expire }} days</span>
                                        {% else %}
                                            <span class="expiry-badge fresh">Good for {{ ad.days_to_expire }} days</span>
                                        {% endif %}
                                    </div>
                                {% endif %}
								<div class="price-box">
                                     {% if ad.discount_price %}
                                      <span class="discounted-price">£{{ ad.discount_price|intcomma}}</span>
                                      <span class="main-price">£{{ ad.discount_price|intcomma}}</span>
                                     {% else %}
                                      <span class="discounted-price">£{{ ad.price|intcomma}}</span>
                                    {% endif %}
								</div>
							</div>

						</div>
                        {% endfor %}
					</div>

					<!--=======  End of multi sale slider wrapper  =======-->
				</div>
			</div>
		</div>
	</div>

    <div class="slider multisale-slider mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multisale  slider section title  =======-->

					<div class="section-title modern-section-title">
						<span class="section-pill">Vegetables</span>
					</div>

					<!--=======  End of multisale slider section title  =======-->
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multi sale slider wrapper  =======-->

					<div class="multisale-slider-wrapper">
						<!--=======  single multisale slider product  =======-->
                        {% for ad in ads_veg %}
						<div class="gf-product multisale-slider-product">
							<div class="image">
								<a href="{{ ad.get_absolute_url }}">
									<span class="{{ ad.get_label_display }}">{{ ad.get_status_display }}</span>
                                    {% if ad.delivery %}
                                        <span class="days">Del:{{ ad.delivery }}</span>
                                    {% endif %}
                                    {% for images in ad.get_second_image %}
                                        {% thumbnail images.product_image "260x194" crop="10px 10px"  as im %}
                                                <img  style="margin:{{ im|margin:"260x194" }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}" class="img-fluid "  />
                                        {% endthumbnail %}
                                    {% endfor %}
								</a>
								<div class="product-hover-icons" id = "part{{ ad.id }}">
									{% include 'home/special_section.html' %}
								</div>
							</div>
							<div class="product-content">
								<div class="product-categories">
									<a>{{ ad.category}}</a>
								</div>
								<h3 class="product-title"><a href="{{ ad.get_absolute_url }}">{{ ad.title }}</a></h3>
								<div class="price-box">
                                    {% if ad.discount_price %}
                                      <span class="discounted-price">£{{ ad.discount_price|intcomma}}</span>
                                      <span class="main-price">£{{ ad.discount_price|intcomma}}</span>
                                     {% else %}
                                      <span class="discounted-price">£{{ ad.price|intcomma}}</span>
                                    {% endif %}
								</div>
							</div>

						</div>
                        {% endfor %}
					</div>

					<!--=======  End of multi sale slider wrapper  =======-->
				</div>
			</div>
		</div>
	</div>

    <div class="slider multisale-slider mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multisale  slider section title  =======-->

					<div class="section-title modern-section-title">
						<span class="section-pill">Fruits</span>
					</div>

					<!--=======  End of multisale slider section title  =======-->
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multi sale slider wrapper  =======-->

					<div class="multisale-slider-wrapper">
						<!--=======  single multisale slider product  =======-->
                        {% for ad in ads_fruits %}
						<div class="gf-product multisale-slider-product">
							<div class="image">
								<a href="{{ ad.get_absolute_url }}">
									<span class="{{ ad.get_label_display }}">{{ ad.get_status_display }}</span>
                                    {% if ad.delivery %}
                                        <span class="days">Del:{{ ad.delivery }}</span>
                                    {% endif %}
                                    {% for images in ad.get_second_image %}
                                        {% thumbnail images.product_image "260x194" crop="10px 10px"  as im %}
                                                <img  style="margin:{{ im|margin:"260x194" }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}" class="img-fluid "  />
                                        {% endthumbnail %}
                                    {% endfor %}
								</a>
								<div class="product-hover-icons" id = "part{{ ad.id }}">
									{% include 'home/special_section.html' %}
								</div>
							</div>
							<div class="product-content">
								<div class="product-categories">
									<a>{{ ad.category}}</a>
								</div>
								<h3 class="product-title"><a href="{{ ad.get_absolute_url }}">{{ ad.title }}</a></h3>
								<div class="price-box">
                                    {% if ad.discount_price %}
                                      <span class="discounted-price">£{{ ad.discount_price|intcomma}}</span>
                                      <span class="main-price">£{{ ad.discount_price|intcomma}}</span>
                                     {% else %}
                                      <span class="discounted-price">£{{ ad.price|intcomma}}</span>
                                    {% endif %}
								</div>
							</div>

						</div>
                        {% endfor %}
					</div>

					<!--=======  End of multi sale slider wrapper  =======-->
				</div>
			</div>
		</div>
	</div>


    <div class="slider multisale-slider mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multisale  slider section title  =======-->

					<div class="section-title modern-section-title">
						<span class="section-pill">Grains</span>
					</div>

					<!--=======  End of multisale slider section title  =======-->
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multi sale slider wrapper  =======-->

					<div class="multisale-slider-wrapper">
						<!--=======  single multisale slider product  =======-->
                        {% for ad in ads_grains %}
						<div class="gf-product multisale-slider-product">
							<div class="image">
								<a href="{{ ad.get_absolute_url }}">
									<span class="{{ ad.get_label_display }}">{{ ad.get_status_display }}</span>
                                    {% if ad.delivery %}
                                        <span class="days">Del:{{ ad.delivery }}</span>
                                    {% endif %}
                                    {% for images in ad.get_second_image %}
                                        {% thumbnail images.product_image "260x194" crop="10px 10px"  as im %}
                                                <img  style="margin:{{ im|margin:"260x194" }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}" class="img-fluid "  />
                                        {% endthumbnail %}
                                    {% endfor %}
								</a>
								<div class="product-hover-icons" id = "part{{ ad.id }}">
									{% include 'home/special_section.html' %}
								</div>
							</div>
							<div class="product-content">
								<div class="product-categories">
									<a>{{ ad.category}}</a>
								</div>
								<h3 class="product-title"><a href="{{ ad.get_absolute_url }}">{{ ad.title }}</a></h3>
								<div class="price-box">
                                    {% if ad.discount_price %}
                                      <span class="discounted-price">£{{ ad.discount_price|intcomma}}</span>
                                      <span class="main-price">£{{ ad.discount_price|intcomma}}</span>
                                     {% else %}
                                      <span class="discounted-price">£{{ ad.price|intcomma}}</span>
                                    {% endif %}
								</div>
							</div>

						</div>
                        {% endfor %}
					</div>

					<!--=======  End of multi sale slider wrapper  =======-->
				</div>
			</div>
		</div>
	</div>

    <div class="slider multisale-slider mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multisale  slider section title  =======-->

					<div class="section-title modern-section-title">
						<span class="section-pill">Seafoods</span>
					</div>

					<!--=======  End of multisale slider section title  =======-->
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multi sale slider wrapper  =======-->

					<div class="multisale-slider-wrapper">
						<!--=======  single multisale slider product  =======-->
                        {% for ad in ads_seafood %}
						<div class="gf-product multisale-slider-product">
							<div class="image">
								<a href="{{ ad.get_absolute_url }}">
									<span class="{{ ad.get_label_display }}">{{ ad.get_status_display }}</span>
                                    {% if ad.delivery %}
                                        <span class="days">Del:{{ ad.delivery }}</span>
                                    {% endif %}
                                    {% for images in ad.get_second_image %}
                                        {% thumbnail images.product_image "260x194" crop="10px 10px"  as im %}
                                                <img  style="margin:{{ im|margin:"260x194" }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}" class="img-fluid "  />
                                        {% endthumbnail %}
                                    {% endfor %}
								</a>
								<div class="product-hover-icons" id = "part{{ ad.id }}">
									{% include 'home/special_section.html' %}
								</div>
							</div>
							<div class="product-content">
								<div class="product-categories">
									<a>{{ ad.category}}</a>
								</div>
								<h3 class="product-title"><a href="{{ ad.get_absolute_url }}">{{ ad.title }}</a></h3>
								<div class="price-box">
                                    {% if ad.discount_price %}
                                      <span class="discounted-price">£{{ ad.discount_price|intcomma}}</span>
                                      <span class="main-price">£{{ ad.discount_price|intcomma}}</span>
                                     {% else %}
                                      <span class="discounted-price">£{{ ad.price|intcomma}}</span>
                                    {% endif %}
								</div>
							</div>

						</div>
                        {% endfor %}
					</div>

					<!--=======  End of multi sale slider wrapper  =======-->
				</div>
			</div>
		</div>
	</div>

    <div class="slider multisale-slider mb-35">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multisale  slider section title  =======-->

					<div class="section-title modern-section-title">
						<span class="section-pill">Spices</span>
					</div>

					<!--=======  End of multisale slider section title  =======-->
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<!--=======  multi sale slider wrapper  =======-->

					<div class="multisale-slider-wrapper">
						<!--=======  single multisale slider product  =======-->
                        {% for ad in ads_spices %}
						<div class="gf-product multisale-slider-product">
							<div class="image">
								<a href="{{ ad.get_absolute_url }}">
									<span class="{{ ad.get_label_display }}">{{ ad.get_status_display }}</span>
                                    {% if ad.delivery %}
                                        <span class="days">Del:{{ ad.delivery }}</span>
                                    {% endif %}
                                    {% for images in ad.get_second_image %}
                                        {% thumbnail images.product_image "260x194" crop="10px 10px"  as im %}
                                                <img  style="margin:{{ im|margin:"260x194" }}" src="{{ im.url }}" width="{{ im.x }}" height="{{ im.y }}" class="img-fluid "  />
                                        {% endthumbnail %}
                                    {% endfor %}
								</a>
								<div class="product-hover-icons" id = "part{{ ad.id }}">
									{% include 'home/special_section.html' %}
								</div>
							</div>
							<div class="product-content">
								<div class="product-categories">
									<a>{{ ad.category}}</a>
								</div>
								<h3 class="product-title"><a href="{{ ad.get_absolute_url }}">{{ ad.title }}</a></h3>
								<div class="price-box">
                                    {% if ad.discount_price %}
                                      <span class="discounted-price">£{{ ad.discount_price|intcomma}}</span>
                                      <span class="main-price">£{{ ad.discount_price|intcomma}}</span>
                                     {% else %}
                                      <span class="discounted-price">£{{ ad.price|intcomma}}</span>
                                    {% endif %}
								</div>
							</div>

						</div>
                        {% endfor %}
					</div>

					<!--=======  End of multi sale slider wrapper  =======-->
				</div>
			</div>
            <br>
            <div class="row">
                <a href="{% url 'home:ads_list' %}" class="slider-btn" style="margin-left: 40%">SHOW ALL</a>
            </div>
		</div>
	</div>

     {% include 'home/affiliate.html' %}

    <br>

    </div>
    <script>
        (() => {
            const findButton = document.getElementById("find-shops-btn");
            const resultsContainer = document.getElementById("nearby-results");
            const statusElement = document.getElementById("nearby-status");
            const radiusSelect = document.getElementById("nearby-radius");
            const endpoint = "{% url 'home:nearby_shops' %}";

            const renderStatus = (message, tone = "text-muted") => {
                statusElement.className = `nearby-status ${tone}`;
                statusElement.textContent = message;
            };

            const renderShops = (shops) => {
                resultsContainer.innerHTML = "";
                if (!shops.length) {
                    renderStatus("No shops found within the selected radius. Try expanding your search.");
                    return;
                }
                renderStatus(`Found ${shops.length} shop${shops.length > 1 ? "s" : ""} near you.`);
                shops.forEach((shop) => {
                    const card = document.createElement("div");
                    card.className = "col-lg-4 col-md-6 mb-20";
                    const distance = shop.distance_km !== null ? `${shop.distance_km} km away` : "Distance unavailable";
                    card.innerHTML = `
                        <div class="nearby-shop-card">
                            <div class="nearby-card-media" aria-hidden="true"></div>
                            <div class="nearby-card-body">
                                <h4>${shop.name}</h4>
                                <p>${shop.address}${shop.city ? `, ${shop.city}` : ""}</p>
                                <p class="text-muted mb-0">${distance}</p>
                                <button class="nearby-card-btn" type="button">View Details</button>
                            </div>
                        </div>
                    `;
                    resultsContainer.appendChild(card);
                });
            };

            const handleError = (message) => {
                renderStatus(message, "text-danger");
                resultsContainer.innerHTML = "";
            };

            const fetchNearbyShops = () => {
                if (!navigator.geolocation) {
                    handleError("Geolocation is not supported by your browser.");
                    return;
                }
                renderStatus("Fetching your location…");
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const radius = radiusSelect ? radiusSelect.value : 5;
                        const params = new URLSearchParams({
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            radius: radius,
                        });
                        try {
                            const response = await fetch(`${endpoint}?${params.toString()}`);
                            if (!response.ok) {
                                throw new Error("Unable to fetch nearby shops.");
                            }
                            const data = await response.json();
                            renderShops(data.shops || []);
                        } catch (error) {
                            handleError("We couldn't load nearby shops. Please try again.");
                        }
                    },
                    () => {
                        handleError("Location access denied. Enable location permissions to continue.");
                    },
                    { timeout: 10000 }
                );
            };

            if (findButton) {
                findButton.addEventListener("click", fetchNearbyShops);
            }

            fetchNearbyShops();
        })();
    </script>
{% endblock %}
